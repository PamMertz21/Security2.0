# ================================================
# Security Configuration for FindMyProf
# ================================================

# Disable directory browsing
Options -Indexes

# Prevent access to hidden files and directories
<FilesMatch "^\.">
  Require all denied
</FilesMatch>

# Block access to source maps (these reveal original code)
<FilesMatch "\.(map)$">
  Require all denied
</FilesMatch>

# Block access to sensitive files
<FilesMatch "\.(env|ini|sql|bak|backup|log|config|conf|yml|yaml|json|lock)$">
  Require all denied
</FilesMatch>

# Protect specific files
<FilesMatch "(package\.json|package-lock\.json|composer\.json|composer\.lock|vite\.config\.js|eslint\.config\.js|jsconfig\.json|\.editorconfig|\.gitignore|\.gitattributes)$">
  Require all denied
</FilesMatch>

# Block access to node_modules and src directories in production
# Comment these out in development if needed
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteRule ^node_modules/ - [F,L]
  RewriteRule ^src/ - [F,L]
  RewriteRule ^views/ - [F,L]
</IfModule>

# ================================================
# Security Headers
# ================================================

<IfModule mod_headers.c>
  # Prevent MIME type sniffing
  Header set X-Content-Type-Options "nosniff"
  
  # Enable XSS protection (legacy browsers)
  Header set X-XSS-Protection "1; mode=block"
  
  # Prevent clickjacking
  Header set X-Frame-Options "SAMEORIGIN"
  
  # Referrer Policy
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  
  # Remove server signature
  Header unset Server
  Header unset X-Powered-By
  
  # Content Security Policy (adjust based on your needs)
  # This is a strict example - you may need to modify it
  Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self'"
  
  # Permissions Policy (formerly Feature Policy)
  Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# ================================================
# Caching and Performance
# ================================================

<IfModule mod_expires.c>
  ExpiresActive On
  
  # Images
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # CSS and JavaScript (hashed filenames = can cache forever)
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  
  # Fonts
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  
  # HTML (short cache for SPAs)
  ExpiresByType text/html "access plus 0 seconds"
</IfModule>

<IfModule mod_headers.c>
  # Cache-Control for assets (Vite adds hashes, so cache forever)
  <FilesMatch "\.(js|css|woff2|woff|ttf|jpg|jpeg|png|gif|svg|webp|ico)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
  
  # No cache for HTML
  <FilesMatch "\.html$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires 0
  </FilesMatch>
</IfModule>

# ================================================
# Single Page Application (SPA) Routing
# ================================================

<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # If the request is for a file or directory that exists, serve it directly
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  
  # Otherwise, route to index.html (for Vue Router)
  RewriteRule ^ index.html [L]
</IfModule>

# ================================================
# Disable Server Signature
# ================================================

ServerSignature Off
